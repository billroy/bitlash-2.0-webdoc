a:202:{i:0;a:3:{i:0;s:14:"document_start";i:1;a:0:{}i:2;i:0;}i:1;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:0;}i:2;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:77:"This is a Bitlash-powered Ethernet web server and telnet console for Arduino.";}i:2;i:1;}i:3;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:78;}i:4;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:78;}i:5;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:27:"It works with the official ";}i:2;i:80;}i:6;a:3:{i:0;s:12:"externallink";i:1;a:2:{i:0;s:51:"http://www.arduino.cc/en/Main/ArduinoEthernetShield";i:1;s:23:"Arduino Ethernet shield";}i:2;i:107;}i:7;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:31:" and compatible Arduino boards.";}i:2;i:186;}i:8;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:217;}i:9;a:3:{i:0;s:6:"header";i:1;a:3:{i:0;s:15:"Getting Started";i:1;i:5;i:2;i:219;}i:2;i:219;}i:10;a:3:{i:0;s:12:"section_open";i:1;a:1:{i:0;i:5;}i:2;i:219;}i:11;a:3:{i:0;s:10:"listo_open";i:1;a:0:{}i:2;i:240;}i:12;a:3:{i:0;s:13:"listitem_open";i:1;a:1:{i:0;i:1;}i:2;i:240;}i:13;a:3:{i:0;s:16:"listcontent_open";i:1;a:0:{}i:2;i:240;}i:14;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:94:" Adjust the IP address, port, and default gateway in the code to be suitable for your network.";}i:2;i:244;}i:15;a:3:{i:0;s:17:"listcontent_close";i:1;a:0:{}i:2;i:338;}i:16;a:3:{i:0;s:14:"listitem_close";i:1;a:0:{}i:2;i:338;}i:17;a:3:{i:0;s:13:"listitem_open";i:1;a:1:{i:0;i:1;}i:2;i:338;}i:18;a:3:{i:0;s:16:"listcontent_open";i:1;a:0:{}i:2;i:338;}i:19;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:51:" Upload the BitlashWebServer sketch to your Arduino";}i:2;i:342;}i:20;a:3:{i:0;s:17:"listcontent_close";i:1;a:0:{}i:2;i:393;}i:21;a:3:{i:0;s:10:"listu_open";i:1;a:0:{}i:2;i:393;}i:22;a:3:{i:0;s:13:"listitem_open";i:1;a:1:{i:0;i:3;}i:2;i:393;}i:23;a:3:{i:0;s:16:"listcontent_open";i:1;a:0:{}i:2;i:393;}i:24;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:6:" File ";}i:2;i:401;}i:25;a:3:{i:0;s:6:"entity";i:1;a:1:{i:0;s:2:"->";}i:2;i:407;}i:26;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:10:" Examples ";}i:2;i:409;}i:27;a:3:{i:0;s:6:"entity";i:1;a:1:{i:0;s:2:"->";}i:2;i:419;}i:28;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:9:" Bitlash ";}i:2;i:421;}i:29;a:3:{i:0;s:6:"entity";i:1;a:1:{i:0;s:2:"->";}i:2;i:430;}i:30;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:17:" BitlashWebServer";}i:2;i:432;}i:31;a:3:{i:0;s:17:"listcontent_close";i:1;a:0:{}i:2;i:449;}i:32;a:3:{i:0;s:14:"listitem_close";i:1;a:0:{}i:2;i:449;}i:33;a:3:{i:0;s:13:"listitem_open";i:1;a:1:{i:0;i:3;}i:2;i:449;}i:34;a:3:{i:0;s:16:"listcontent_open";i:1;a:0:{}i:2;i:449;}i:35;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:5:"File ";}i:2;i:457;}i:36;a:3:{i:0;s:6:"entity";i:1;a:1:{i:0;s:2:"->";}i:2;i:462;}i:37;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:7:" Upload";}i:2;i:464;}i:38;a:3:{i:0;s:17:"listcontent_close";i:1;a:0:{}i:2;i:471;}i:39;a:3:{i:0;s:14:"listitem_close";i:1;a:0:{}i:2;i:471;}i:40;a:3:{i:0;s:11:"listu_close";i:1;a:0:{}i:2;i:471;}i:41;a:3:{i:0;s:14:"listitem_close";i:1;a:0:{}i:2;i:471;}i:42;a:3:{i:0;s:13:"listitem_open";i:1;a:1:{i:0;i:1;}i:2;i:471;}i:43;a:3:{i:0;s:16:"listcontent_open";i:1;a:0:{}i:2;i:471;}i:44;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:116:" For debugging, connect via your favorite Serial Monitor at 57600. You can watch the web traffic and issue commands.";}i:2;i:475;}i:45;a:3:{i:0;s:17:"listcontent_close";i:1;a:0:{}i:2;i:591;}i:46;a:3:{i:0;s:14:"listitem_close";i:1;a:0:{}i:2;i:591;}i:47;a:3:{i:0;s:13:"listitem_open";i:1;a:1:{i:0;i:1;}i:2;i:591;}i:48;a:3:{i:0;s:16:"listcontent_open";i:1;a:0:{}i:2;i:591;}i:49;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:90:" Navigate to the configured IP/port in your browser.  The default settings in the code is ";}i:2;i:595;}i:50;a:3:{i:0;s:12:"externallink";i:1;a:2:{i:0;s:24:"http://192.168.1.27:8080";i:1;N;}i:2;i:685;}i:51;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:1:".";}i:2;i:709;}i:52;a:3:{i:0;s:17:"listcontent_close";i:1;a:0:{}i:2;i:710;}i:53;a:3:{i:0;s:14:"listitem_close";i:1;a:0:{}i:2;i:710;}i:54;a:3:{i:0;s:13:"listitem_open";i:1;a:1:{i:0;i:1;}i:2;i:710;}i:55;a:3:{i:0;s:16:"listcontent_open";i:1;a:0:{}i:2;i:710;}i:56;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:16:" If you see the ";}i:2;i:714;}i:57;a:3:{i:0;s:18:"doublequoteopening";i:1;a:0:{}i:2;i:730;}i:58;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:24:"Bitlash web server here!";}i:2;i:731;}i:59;a:3:{i:0;s:18:"doublequoteclosing";i:1;a:0:{}i:2;i:755;}i:60;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:80:" banner you've connected.  You'll also see the hit logged on the serial monitor.";}i:2;i:756;}i:61;a:3:{i:0;s:17:"listcontent_close";i:1;a:0:{}i:2;i:836;}i:62;a:3:{i:0;s:14:"listitem_close";i:1;a:0:{}i:2;i:836;}i:63;a:3:{i:0;s:13:"listitem_open";i:1;a:1:{i:0;i:1;}i:2;i:836;}i:64;a:3:{i:0;s:16:"listcontent_open";i:1;a:0:{}i:2;i:836;}i:65;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:108:" For remote maintenance, telnet to the same address/port and provide the password.  The default password is ";}i:2;i:840;}i:66;a:3:{i:0;s:18:"doublequoteopening";i:1;a:0:{}i:2;i:948;}i:67;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:11:"open sesame";}i:2;i:949;}i:68;a:3:{i:0;s:18:"doublequoteclosing";i:1;a:0:{}i:2;i:960;}i:69;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:25:"; please change it below.";}i:2;i:961;}i:70;a:3:{i:0;s:17:"listcontent_close";i:1;a:0:{}i:2;i:986;}i:71;a:3:{i:0;s:14:"listitem_close";i:1;a:0:{}i:2;i:986;}i:72;a:3:{i:0;s:13:"listitem_open";i:1;a:1:{i:0;i:1;}i:2;i:986;}i:73;a:3:{i:0;s:16:"listcontent_open";i:1;a:0:{}i:2;i:986;}i:74;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:37:" Read the rest, and go make webpages!";}i:2;i:990;}i:75;a:3:{i:0;s:17:"listcontent_close";i:1;a:0:{}i:2;i:1027;}i:76;a:3:{i:0;s:14:"listitem_close";i:1;a:0:{}i:2;i:1027;}i:77;a:3:{i:0;s:11:"listo_close";i:1;a:0:{}i:2;i:1027;}i:78;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:1027;}i:79;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:47:"There are two ways to define a web server page:";}i:2;i:1029;}i:80;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:1077;}i:81;a:3:{i:0;s:10:"listo_open";i:1;a:0:{}i:2;i:1077;}i:82;a:3:{i:0;s:13:"listitem_open";i:1;a:1:{i:0;i:1;}i:2;i:1077;}i:83;a:3:{i:0;s:16:"listcontent_open";i:1;a:0:{}i:2;i:1077;}i:84;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:43:" You can compile in pages by modifying the ";}i:2;i:1081;}i:85;a:3:{i:0;s:13:"emphasis_open";i:1;a:0:{}i:2;i:1124;}i:86;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:17:"builtin_page_list";}i:2;i:1126;}i:87;a:3:{i:0;s:14:"emphasis_close";i:1;a:0:{}i:2;i:1143;}i:88;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:223:" in the code.  Built-in pages can contain bitlash code that's within square brackets [ ].  The server executes the code in [ ] while rendering the page output; any printed output the code generates will show up on the page.";}i:2;i:1145;}i:89;a:3:{i:0;s:17:"listcontent_close";i:1;a:0:{}i:2;i:1368;}i:90;a:3:{i:0;s:14:"listitem_close";i:1;a:0:{}i:2;i:1368;}i:91;a:3:{i:0;s:11:"listo_close";i:1;a:0:{}i:2;i:1368;}i:92;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:1368;}i:93;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:13:"For example: ";}i:2;i:1370;}i:94;a:3:{i:0;s:18:"doublequoteopening";i:1;a:0:{}i:2;i:1383;}i:95;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:31:"The uptime is: [print millis]ms";}i:2;i:1384;}i:96;a:3:{i:0;s:18:"doublequoteclosing";i:1;a:0:{}i:2;i:1415;}i:97;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:10:" (see the ";}i:2;i:1416;}i:98;a:3:{i:0;s:18:"doublequoteopening";i:1;a:0:{}i:2;i:1426;}i:99;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:5:"index";}i:2;i:1427;}i:100;a:3:{i:0;s:18:"doublequoteclosing";i:1;a:0:{}i:2;i:1432;}i:101;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:15:" example below)";}i:2;i:1433;}i:102;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:1449;}i:103;a:3:{i:0;s:10:"listo_open";i:1;a:0:{}i:2;i:1449;}i:104;a:3:{i:0;s:13:"listitem_open";i:1;a:1:{i:0;i:1;}i:2;i:1449;}i:105;a:3:{i:0;s:16:"listcontent_open";i:1;a:0:{}i:2;i:1449;}i:106;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:97:" Any Bitlash function whose name begins with the underscore character '_'  is considered a valid ";}i:2;i:1453;}i:107;a:3:{i:0;s:7:"acronym";i:1;a:1:{i:0;s:3:"URL";}i:2;i:1550;}i:108;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:60:" mount point and its output is sent as a response when that ";}i:2;i:1553;}i:109;a:3:{i:0;s:7:"acronym";i:1;a:1:{i:0;s:3:"URL";}i:2;i:1613;}i:110;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:12:" is invoked.";}i:2;i:1616;}i:111;a:3:{i:0;s:17:"listcontent_close";i:1;a:0:{}i:2;i:1628;}i:112;a:3:{i:0;s:14:"listitem_close";i:1;a:0:{}i:2;i:1628;}i:113;a:3:{i:0;s:11:"listo_close";i:1;a:0:{}i:2;i:1628;}i:114;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:1628;}i:115;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:34:"For example: the Bitlash function ";}i:2;i:1630;}i:116;a:3:{i:0;s:13:"emphasis_open";i:1;a:0:{}i:2;i:1664;}i:117;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:7:"_uptime";}i:2;i:1666;}i:118;a:3:{i:0;s:14:"emphasis_close";i:1;a:0:{}i:2;i:1673;}i:119;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:24:" is called when the url ";}i:2;i:1675;}i:120;a:3:{i:0;s:13:"emphasis_open";i:1;a:0:{}i:2;i:1699;}i:121;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:7:"/uptime";}i:2;i:1701;}i:122;a:3:{i:0;s:14:"emphasis_close";i:1;a:0:{}i:2;i:1708;}i:123;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:13:" is requested";}i:2;i:1710;}i:124;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:1729;}i:125;a:3:{i:0;s:4:"code";i:1;a:3:{i:0;s:53:"
 function _uptime {print "Uptime is ",millis,"ms";}
";i:1;N;i:2;N;}i:2;i:1729;}i:126;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:1729;}i:127;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:68:"From another terminal window we can test what the browser might see:";}i:2;i:1792;}i:128;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:1866;}i:129;a:3:{i:0;s:4:"code";i:1;a:3:{i:0;s:62:"
$ curl http://192.168.1.27:8080/uptime
Uptime is 123324 ms
$
";i:1;N;i:2;N;}i:2;i:1866;}i:130;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:1866;}i:131;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:51:"For example: send the value of analog input 3 when ";}i:2;i:1938;}i:132;a:3:{i:0;s:18:"doublequoteclosing";i:1;a:0:{}i:2;i:1989;}i:133;a:3:{i:0;s:6:"entity";i:1;a:1:{i:0;s:3:"...";}i:2;i:1990;}i:134;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:6:"/volt3";}i:2;i:1993;}i:135;a:3:{i:0;s:18:"doublequoteclosing";i:1;a:0:{}i:2;i:1999;}i:136;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:14:" is requested:";}i:2;i:2000;}i:137;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:2020;}i:138;a:3:{i:0;s:4:"code";i:1;a:3:{i:0;s:29:"
function _volt3 {print a3;}
";i:1;N;i:2;N;}i:2;i:2020;}i:139;a:3:{i:0;s:13:"section_close";i:1;a:0:{}i:2;i:2058;}i:140;a:3:{i:0;s:6:"header";i:1;a:3:{i:0;s:31:"Special pages _index and _error";i:1;i:5;i:2;i:2058;}i:2;i:2058;}i:141;a:3:{i:0;s:12:"section_open";i:1;a:1:{i:0;i:5;}i:2;i:2058;}i:142;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:2058;}i:143;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:31:"If you define a function named ";}i:2;i:2096;}i:144;a:3:{i:0;s:11:"strong_open";i:1;a:0:{}i:2;i:2127;}i:145;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:6:"_index";}i:2;i:2129;}i:146;a:3:{i:0;s:12:"strong_close";i:1;a:0:{}i:2;i:2135;}i:147;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:70:", it will be rendered when the root url is requested.  Think of it as ";}i:2;i:2137;}i:148;a:3:{i:0;s:13:"emphasis_open";i:1;a:0:{}i:2;i:2207;}i:149;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:10:"index.html";}i:2;i:2209;}i:150;a:3:{i:0;s:14:"emphasis_close";i:1;a:0:{}i:2;i:2219;}i:151;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:1:".";}i:2;i:2221;}i:152;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:2222;}i:153;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:2222;}i:154;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:31:"If you define a function named ";}i:2;i:2224;}i:155;a:3:{i:0;s:11:"strong_open";i:1;a:0:{}i:2;i:2255;}i:156;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:6:"_error";}i:2;i:2257;}i:157;a:3:{i:0;s:12:"strong_close";i:1;a:0:{}i:2;i:2263;}i:158;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:79:" it will be rendered when an error occurs, in place of the built-in error page.";}i:2;i:2265;}i:159;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:2344;}i:160;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:2344;}i:161;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:187:"Both of these uses depend on an additional feature: a page handler defined as a Bitlash function takes priority over a built-in page.  You can use this to mask or override built-in pages.";}i:2;i:2346;}i:162;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:2533;}i:163;a:3:{i:0;s:13:"section_close";i:1;a:0:{}i:2;i:2535;}i:164;a:3:{i:0;s:6:"header";i:1;a:3:{i:0;s:13:"Telnet access";i:1;i:5;i:2;i:2535;}i:2;i:2535;}i:165;a:3:{i:0;s:12:"section_open";i:1;a:1:{i:0;i:5;}i:2;i:2535;}i:166;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:2535;}i:167;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:150:"The password-protected telnet console operating on the same IP and port as the web server.
It provides full access to Bitlash, so you can log in with ";}i:2;i:2555;}i:168;a:3:{i:0;s:13:"emphasis_open";i:1;a:0:{}i:2;i:2705;}i:169;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:6:"telnet";}i:2;i:2707;}i:170;a:3:{i:0;s:14:"emphasis_close";i:1;a:0:{}i:2;i:2713;}i:171;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:4:" or ";}i:2;i:2715;}i:172;a:3:{i:0;s:13:"emphasis_open";i:1;a:0:{}i:2;i:2719;}i:173;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:2:"nc";}i:2;i:2721;}i:174;a:3:{i:0;s:14:"emphasis_close";i:1;a:0:{}i:2;i:2723;}i:175;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:58:" and do bitlash stuff, including of course defining a new ";}i:2;i:2725;}i:176;a:3:{i:0;s:13:"emphasis_open";i:1;a:0:{}i:2;i:2783;}i:177;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:9:"_function";}i:2;i:2785;}i:178;a:3:{i:0;s:14:"emphasis_close";i:1;a:0:{}i:2;i:2794;}i:179;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:26:" to expose a new web page.";}i:2;i:2796;}i:180;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:2828;}i:181;a:3:{i:0;s:4:"code";i:1;a:3:{i:0;s:152:"
...$ telnet 192.168.1.27 8080
Trying 192.168.1.27...
Connected to 192.168.1.27.
Escape character is '^]'.
open sesame
Bitlash web server here! v0.3
> 
";i:1;N;i:2;N;}i:2;i:2828;}i:182;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:2828;}i:183;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:31:"The default telnet password is ";}i:2;i:2989;}i:184;a:3:{i:0;s:18:"doublequoteopening";i:1;a:0:{}i:2;i:3020;}i:185;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:11:"open sesame";}i:2;i:3021;}i:186;a:3:{i:0;s:18:"doublequoteclosing";i:1;a:0:{}i:2;i:3032;}i:187;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:63:"; please change it below or risk
becoming a security statistic.";}i:2;i:3033;}i:188;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:3096;}i:189;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:3096;}i:190;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:247:"Please note that the server is not smart enough to process web requests while a telnet session is open.  (Perhaps this is a feature.)  In any event, you will find it is necessary to quit your telnet connection to test your new page in the browser.";}i:2;i:3098;}i:191;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:3345;}i:192;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:3345;}i:193;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:28:"To log out, you may use the ";}i:2;i:3347;}i:194;a:3:{i:0;s:18:"doublequoteopening";i:1;a:0:{}i:2;i:3375;}i:195;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:6:"logout";}i:2;i:3376;}i:196;a:3:{i:0;s:18:"doublequoteclosing";i:1;a:0:{}i:2;i:3382;}i:197;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:112:" command, or the usual ^] followed by quit if you're using old-school telnet.  If you're using nc, ^C will quit.";}i:2;i:3383;}i:198;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:3495;}i:199;a:3:{i:0;s:4:"code";i:1;a:3:{i:0;s:6162:"
#include <SPI.h>
#include <Ethernet.h>
#include "bitlash.h"

// Command line buffer for alternate command input stream
#define LBUFLEN 80
byte llen;
char linebuf[LBUFLEN];

////////////////////////////////////////
//
//	Ethernet configuration
//	Adjust for local conditions
//
byte mac[] 		= {'b','i','t','c','h','i'};
byte ip[]  		= {192, 168, 1, 27};
byte gateway[] 	= {192, 168, 1, 1};
byte subnet[] 	= {255, 255, 255, 0};
#define PORT 8080

#define PASSPHRASE "open sesame"
#define BAD_PASSWORD_MAX 3

//
////////////////////////////////////////

#define BANNER "Bitlash web server here! v0.3\r\n"
#define INDEX_MACRO "_index"
#define ERROR_MACRO "_error"
#define ERROR_PAGE  "error"

#define CONTENT_TYPE_PLAIN "Content-Type: text/plain\r\n\r\n"	// enable this for plaintext output
#define CONTENT_TYPE_HTML  "Content-Type: text/html\r\n\r\n"	// enable this for HTML output
#define CONTENT_TYPE CONTENT_TYPE_PLAIN

#define HTTP_200_OK "HTTP/1.1 200 OK\r\n"
#define HTTP_404_NOTFOUND "HTTP/1.1 404 Not Found\r\n"

typedef struct {
	const prog_char *url;
	const prog_char *pagetext;
} builtin_page;


/////////////////////////////////////////////
//
// 	Built-in HTML content: Add your new built-in pages here:
//
//	Define a URL mount point and the text of your page like the ones already there
//	Add them to the builtin_pages table just like the ones already there
//
//	Each string needs \0 at the end.  
//	If you leave one off, you are guaranteed an interesting debugging experience
//
//	Lines will run together in text/plain mode without \r\n,
//	so mind your \r\n line endings.
//

// This block generates the built-in index page that is called on /
const prog_char index_url[] PROGMEM = { "index\0" };
const prog_char default_index_page[] PROGMEM = { 
	BANNER
	"Uptime: [print millis,]ms\r\n"
	"Powered by Bitlash.\r\n"
	"\0"	// must be last
};

// This block generates the built-in error page
const prog_char error_url[] PROGMEM = { "error\0" };
const prog_char error_page[] PROGMEM = { "Not found.\r\n\0" };

// Add new pages here, just like these
builtin_page builtin_page_list[] = {
	{ index_url, default_index_page },
	{ error_url, error_page },
	{ 0, 0 }	// marks end, must be last
};

//
//	End of Static HTML content
//
/////////////////////////////////////////////


int findStaticPage(char *pagename) {
int i=0;
const prog_char *name;
	for (;;) {
		name = builtin_page_list[i].url;
		if (!name) break;
		if (!strcmp_P((const char *) pagename, name)) return i;
		i++;
	}
	return(-1);
}


void sendStaticPage(char *pagename) {

	int pageindex = findStaticPage(pagename);
	if (pageindex < 0) return;

	const prog_char *addr = builtin_page_list[pageindex].pagetext;
	for (;;) {
		byte b = pgm_read_byte(addr++);
		if (b == '\0') break;
		else if (b == '[') {
			char *optr = linebuf;
			while ((b != ']') && ((optr-linebuf) < LBUFLEN)) {
				b = pgm_read_byte(addr++);
				if (b == ']') {
					*optr = '\0';
					doCommand(linebuf);
				}
				else *optr++ = b;
			}
		}
		else serialHandler(b);
	}
}

//
/////////////////////////////////////////////


extern void prompt(void);

Server server = Server(PORT);
Client client(MAX_SOCK_NUM);		// declare an inactive client

numvar func_logout(void) {
	client.stop();
}

void serialHandler(byte b) {
	Serial.print(b, BYTE);
	if (client && client.connected()) client.print((char) b);
}

void sendstring(char *ptr) {
	while (*ptr) serialHandler(*ptr++);
}

byte unlocked;
byte badpasswordcount;

#define IDBUFLEN 13
char pagename[IDBUFLEN];


byte isGET(char *line) {
	return !strncmp(line, "GET /", 5);
}

byte isUnsupportedHTTP(char *line) {
	return !strncmp(line, "PUT /", 5) ||
		!strncmp(line, "POST /", 6) ||
		!strncmp(line, "HEAD /", 6);
}


void servePage(char *pagename) {
	Serial.print("\r\nWeb request: ");
	Serial.print(&pagename[1]);
	Serial.print(" ");
	Serial.println(millis());

	if (getValue(pagename) >= 0) {		// _macro
		sendstring(HTTP_200_OK);
		sendstring(CONTENT_TYPE);			// configure this above
		doCommand(pagename);
	}
	else if (findStaticPage(&pagename[1]) >= 0) {	// static page
		sendstring(HTTP_200_OK);
		sendstring(CONTENT_TYPE);			// configure this above
		sendStaticPage(&pagename[1]);
	}
	else {
		sendstring(HTTP_404_NOTFOUND);
		sendstring(CONTENT_TYPE);
		if (getValue(ERROR_MACRO) >= 0) doCommand(ERROR_MACRO);
		else if (findStaticPage(ERROR_PAGE) >= 0) sendStaticPage(ERROR_PAGE);
		else sendstring("Error: not found.\r\n");	// shouldn't happen!
	}
	delay(1);
	client.stop();
}


void handleInputLine(char *line) {

	// check for web GET command: GET /macro HTTP/1.1
	if (isGET(line)) {
		char *iptr = line+5;	// point to first letter of macro name
		char *optr = pagename;
		*optr++ = '_';			// given "index" we search for macro "_index"
		while (*iptr && (*iptr != ' ') && ((optr - pagename) < (IDBUFLEN-1))) {
			*optr++ = *iptr++;
		}
		*optr = '\0';
		if (strlen(pagename) == 1) strcpy(pagename, INDEX_MACRO);	// map / to /index thus _index
		servePage(pagename);
	}
	else if (isUnsupportedHTTP(line)) client.stop();

	// not a web command: if we're locked, check for the passphrase
	else if (!unlocked) {
		if (!strcmp(line, PASSPHRASE)) {
			sendstring(BANNER);
			unlocked = 1;
			prompt();
		}
		else if ((strlen(line) > 0) && (++badpasswordcount > BAD_PASSWORD_MAX)) client.stop();
		else {
			if (badpasswordcount) delay(1000);
			sendstring("Password: ");
		}
	}
	
	// unlocked, it's apparently a telnet command, execute it
	else {
		doCommand(line);
		prompt();
	}
}


void setup(void) {

	initBitlash(57600);
	Ethernet.begin(mac, ip, gateway, subnet);
	server.begin();

	addBitlashFunction("logout", &func_logout);
	setOutputHandler(&serialHandler);
}

void loop(void) {
	
	client = server.available();
	if (client) {
		unlocked = 0;
		badpasswordcount = 0;
		while (client.connected()) {
			if (client.available()) {
				char c = client.read();
				if ((c == '\r') || (c == '\n')) {
					if (llen) {
						linebuf[llen] = '\0';
						handleInputLine(linebuf);
						llen = 0;
					}
				}
				else if (llen < LBUFLEN-1) linebuf[llen++] = c;
				else {;}	// drop overtyping on the floor here
			}
			else runBitlash();
		}
	}
	runBitlash();
}
";i:1;N;i:2;N;}i:2;i:3502;}i:200;a:3:{i:0;s:13:"section_close";i:1;a:0:{}i:2;i:9672;}i:201;a:3:{i:0;s:12:"document_end";i:1;a:0:{}i:2;i:9672;}}